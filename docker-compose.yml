version: "3.1"

services:
  web.dev.local:
    build: docker_resources/web
    volumes:
      - ./project:/app:cached
    depends_on:
      - mysql.dev.local
      - redis.dev.local
      - nginx-proxy
    environment:
      - VIRTUAL_HOST=web.dev.local

  mysql.dev.local:
    build: docker_resources/db
    restart: always
    volumes:
      - "./db-data/mysql:/var/lib/mysql"
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password

  redis.dev.local:
    image: redis
    ports:
      - "6379:6379"
    volumes:
      - ./db-data/redis:/data

  nginx-proxy:
    image: jwilder/nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - ./dev-https:/etc/nginx/certs:ro
      - ./docker_resources/nginx/proxy.conf:/etc/nginx/proxy.conf
